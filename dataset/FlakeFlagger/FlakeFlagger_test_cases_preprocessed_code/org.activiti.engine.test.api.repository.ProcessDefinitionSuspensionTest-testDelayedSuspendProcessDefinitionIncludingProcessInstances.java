@Deployment(resources={"org/activiti/engine/test/api/runtime/oneTaskProcess.bpmn20.xml"}) public void testDelayedSuspendProcessDefinitionIncludingProcessInstances(){
assertEquals(nrOfProcessInstances,runtimeService.createProcessInstanceQuery().count());
assertEquals(nrOfProcessInstances,runtimeService.createProcessInstanceQuery().active().count());
assertEquals(0,runtimeService.createProcessInstanceQuery().suspended().count());
assertEquals(0,taskService.createTaskQuery().suspended().count());
assertEquals(nrOfProcessInstances,taskService.createTaskQuery().active().count());
assertEquals(1,repositoryService.createProcessDefinitionQuery().active().count());
assertEquals(0,repositoryService.createProcessDefinitionQuery().suspended().count());
assertEquals(nrOfProcessInstances,runtimeService.createProcessInstanceQuery().count());
assertEquals(1,managementService.createTimerJobQuery().processDefinitionId(processDefinition.getId()).count());
assertEquals(0,managementService.createJobQuery().processDefinitionId(processDefinition.getId()).count());
assertEquals(0,managementService.createTimerJobQuery().processDefinitionId(processDefinition.getId()).count());
fail();
assertEquals(nrOfProcessInstances,runtimeService.createProcessInstanceQuery().count());
assertEquals(0,runtimeService.createProcessInstanceQuery().active().count());
assertEquals(nrOfProcessInstances,runtimeService.createProcessInstanceQuery().suspended().count());
assertEquals(nrOfProcessInstances,taskService.createTaskQuery().suspended().count());
assertEquals(0,taskService.createTaskQuery().active().count());
assertEquals(0,repositoryService.createProcessDefinitionQuery().active().count());
assertEquals(1,repositoryService.createProcessDefinitionQuery().suspended().count());
assertEquals(nrOfProcessInstances,runtimeService.createProcessInstanceQuery().count());
assertEquals(nrOfProcessInstances,runtimeService.createProcessInstanceQuery().active().count());
assertEquals(0,runtimeService.createProcessInstanceQuery().suspended().count());
assertEquals(0,taskService.createTaskQuery().suspended().count());
assertEquals(nrOfProcessInstances,taskService.createTaskQuery().active().count());
assertEquals(1,repositoryService.createProcessDefinitionQuery().active().count());
assertEquals(0,repositoryService.createProcessDefinitionQuery().suspended().count());
}