@Test public void maxConnections() throws IOException, InterruptedException {
assertEquals(0,pool.getConnectionCount());
assertEquals(1,pool.getConnectionCount());
assertEquals(1,pool.getHttpConnectionCount());
assertEquals(0,pool.getSpdyConnectionCount());
assertEquals(2,pool.getConnectionCount());
assertEquals(2,pool.getHttpConnectionCount());
assertEquals(0,pool.getSpdyConnectionCount());
Thread.sleep(50);
assertEquals(2,pool.getConnectionCount());
assertEquals(2,pool.getHttpConnectionCount());
assertEquals(0,pool.getSpdyConnectionCount());
Thread.sleep(50);
assertEquals(2,pool.getConnectionCount());
assertEquals(1,pool.getHttpConnectionCount());
assertEquals(1,pool.getSpdyConnectionCount());
assertNotNull(recycledHttpConnection);
assertTrue(recycledHttpConnection.isAlive());
assertEquals(1,pool.getConnectionCount());
assertEquals(0,pool.getHttpConnectionCount());
assertEquals(1,pool.getSpdyConnectionCount());
assertNotNull(sharedSpdyConnection);
assertEquals(spdyA,sharedSpdyConnection);
assertEquals(1,pool.getConnectionCount());
assertEquals(0,pool.getHttpConnectionCount());
assertEquals(1,pool.getSpdyConnectionCount());
Thread.sleep(50);
assertEquals(2,pool.getConnectionCount());
assertEquals(1,pool.getHttpConnectionCount());
assertEquals(1,pool.getSpdyConnectionCount());
assertNotNull(recycledHttpConnection);
assertTrue(recycledHttpConnection.isAlive());
assertEquals(1,pool.getConnectionCount());
assertEquals(0,pool.getHttpConnectionCount());
assertEquals(1,pool.getSpdyConnectionCount());
assertEquals(spdyA,sharedSpdyConnection);
assertNotNull(sharedSpdyConnection);
assertEquals(1,pool.getConnectionCount());
assertEquals(0,pool.getHttpConnectionCount());
assertEquals(1,pool.getSpdyConnectionCount());
Thread.sleep(50);
assertEquals(2,pool.getConnectionCount());
assertEquals(1,pool.getHttpConnectionCount());
assertEquals(1,pool.getSpdyConnectionCount());
Thread.sleep(50);
assertEquals(2,pool.getConnectionCount());
assertEquals(2,pool.getHttpConnectionCount());
assertEquals(0,pool.getSpdyConnectionCount());
}