@Test public void shouldRetrieveRecordedRequestsResponsesAsLogEntries(){
  httpState.log(new LogEntry().setLogLevel(INFO).setType(NO_MATCH_RESPONSE).setHttpRequest(request("request_one")).setExpectation(new Expectation(request("request_one")).withId("key_one").thenRespond(response("response_two"))).setMessageFormat("no expectation for:{}returning response:{}").setArguments(request("request_one"),notFoundResponse()));
  httpState.log(new LogEntry().setLogLevel(INFO).setType(EXPECTATION_RESPONSE).setHttpRequest(request("request_two")).setHttpResponse(response("response_two")).setMessageFormat("returning error:{}for request:{}for action:{}").setArguments(request("request_two"),response("response_two"),response("response_two")));
  HttpResponse response=httpState.retrieve(request().withQueryStringParameter("type","request_responses").withQueryStringParameter("format","log_entries").withBody(httpRequestSerializer.serialize(request("request_.*"))));
  assertThat(response,is(response().withBody("[" + NEW_LINE + "  {"+ NEW_LINE+ "    \"logLevel\" : \"INFO\","+ NEW_LINE+ "    \"timestamp\" : \""+ LOG_DATE_FORMAT.format(new Date(TimeService.currentTimeMillis()))+ "\","+ NEW_LINE+ "    \"type\" : \"NO_MATCH_RESPONSE\","+ NEW_LINE+ "    \"httpRequest\" : {"+ NEW_LINE+ "      \"path\" : \"request_one\""+ NEW_LINE+ "    },"+ NEW_LINE+ "    \"expectation\" : {"+ NEW_LINE+ "      \"id\" : \"key_one\","+ NEW_LINE+ "      \"priority\" : 0,"+ NEW_LINE+ "      \"httpRequest\" : {"+ NEW_LINE+ "        \"path\" : \"request_one\""+ NEW_LINE+ "      },"+ NEW_LINE+ "      \"times\" : {"+ NEW_LINE+ "        \"unlimited\" : true"+ NEW_LINE+ "      },"+ NEW_LINE+ "      \"timeToLive\" : {"+ NEW_LINE+ "        \"unlimited\" : true"+ NEW_LINE+ "      },"+ NEW_LINE+ "      \"httpResponse\" : {"+ NEW_LINE+ "        \"statusCode\" : 200,"+ NEW_LINE+ "        \"reasonPhrase\" : \"OK\","+ NEW_LINE+ "        \"body\" : \"response_two\""+ NEW_LINE+ "      }"+ NEW_LINE+ "    },"+ NEW_LINE+ "    \"message\" : ["+ NEW_LINE+ "      \"no expectation for:\","+ NEW_LINE+ "      \"\","+ NEW_LINE+ "      \"   {\","+ NEW_LINE+ "      \"      \\\"path\\\" : \\\"request_one\\\"\","+ NEW_LINE+ "      \"   }\","+ NEW_LINE+ "      \"\","+ NEW_LINE+ "      \" returning response:\","+ NEW_LINE+ "      \"\","+ NEW_LINE+ "      \"   {\","+ NEW_LINE+ "      \"      \\\"statusCode\\\" : 404,\","+ NEW_LINE+ "      \"      \\\"reasonPhrase\\\" : \\\"Not Found\\\"\","+ NEW_LINE+ "      \"   }\""+ NEW_LINE+ "    ]"+ NEW_LINE+ "  },"+ NEW_LINE+ "  {"+ NEW_LINE+ "    \"logLevel\" : \"INFO\","+ NEW_LINE+ "    \"timestamp\" : \""+ LOG_DATE_FORMAT.format(new Date(TimeService.currentTimeMillis()))+ "\","+ NEW_LINE+ "    \"type\" : \"EXPECTATION_RESPONSE\","+ NEW_LINE+ "    \"httpRequest\" : {"+ NEW_LINE+ "      \"path\" : \"request_two\""+ NEW_LINE+ "    },"+ NEW_LINE+ "    \"httpResponse\" : {"+ NEW_LINE+ "      \"statusCode\" : 200,"+ NEW_LINE+ "      \"reasonPhrase\" : \"OK\","+ NEW_LINE+ "      \"body\" : \"response_two\""+ NEW_LINE+ "    },"+ NEW_LINE+ "    \"message\" : ["+ NEW_LINE+ "      \"returning error:\","+ NEW_LINE+ "      \"\","+ NEW_LINE+ "      \"   {\","+ NEW_LINE+ "      \"      \\\"path\\\" : \\\"request_two\\\"\","+ NEW_LINE+ "      \"   }\","+ NEW_LINE+ "      \"\","+ NEW_LINE+ "      \" for request:\","+ NEW_LINE+ "      \"\","+ NEW_LINE+ "      \"   {\","+ NEW_LINE+ "      \"      \\\"statusCode\\\" : 200,\","+ NEW_LINE+ "      \"      \\\"reasonPhrase\\\" : \\\"OK\\\",\","+ NEW_LINE+ "      \"      \\\"body\\\" : \\\"response_two\\\"\","+ NEW_LINE+ "      \"   }\","+ NEW_LINE+ "      \"\","+ NEW_LINE+ "      \" for action:\","+ NEW_LINE+ "      \"\","+ NEW_LINE+ "      \"   {\","+ NEW_LINE+ "      \"      \\\"statusCode\\\" : 200,\","+ NEW_LINE+ "      \"      \\\"reasonPhrase\\\" : \\\"OK\\\",\","+ NEW_LINE+ "      \"      \\\"body\\\" : \\\"response_two\\\"\","+ NEW_LINE+ "      \"   }\""+ NEW_LINE+ "    ]"+ NEW_LINE+ "  }"+ NEW_LINE+ "]",MediaType.JSON_UTF_8).withStatusCode(200)));
}
