@Test public void domain_serialization_test() throws Exception {
  final Domain domain=new Domain();
  domain.setHandle("XXXX");
  domain.setLdhName("192.in-addr.arpa");
  final Nameserver nameserver1=new Nameserver();
  nameserver1.setLdhName("ns1.rir.example");
  domain.getNameservers().add(nameserver1);
  final Nameserver nameserver2=new Nameserver();
  nameserver2.setLdhName("ns2.rir.example");
  domain.getNameservers().add(nameserver2);
  final Remark remark=new Remark(Lists.newArrayList("She sells sea shells down by the sea shore.","Originally written by Terry Sullivan."));
  domain.getRemarks().add(remark);
  final Link link=new Link("http://example.net/domain/XXXX","self","http://example.net/domain/XXXXX",null,null);
  domain.getLinks().add(link);
  final Event registrationEvent=new Event();
  registrationEvent.setEventAction(Action.REGISTRATION);
  registrationEvent.setEventDate(LOCAL_DATE_TIME);
  domain.getEvents().add(registrationEvent);
  final Event lastChangedEvent=new Event();
  lastChangedEvent.setEventAction(Action.LAST_CHANGED);
  lastChangedEvent.setEventDate(LOCAL_DATE_TIME);
  lastChangedEvent.setEventActor("joe@example.com");
  domain.getEvents().add(lastChangedEvent);
  final Entity entity=new Entity();
  entity.setHandle("XXXX");
  entity.getRoles().add(Role.REGISTRANT);
  entity.getRemarks().add(remark);
  entity.getEvents().add(registrationEvent);
  entity.getEvents().add(lastChangedEvent);
  domain.getEntitySearchResults().add(entity);
  final Link entityLink=new Link("http://example.net/entity/xxxx","self","http://example.net/entity/xxxx",null,null);
  entity.getLinks().add(entityLink);
  final VCardBuilder builder=new VCardBuilder();
  builder.addVersion().addFn("Joe User").addKind("individual").addOrg("Example").addTitle("Research Scientist").addRole("Project Lead").addAdr(createAddress("","Suite 1234","4321 Rue Somewhere","Quebec","QC","G1V 2M2","Canada")).addTel("tel:+1-555-555-1234;ext=102").addEmail("joe.user@example.com");
  entity.setVCardArray(builder.build());
  final Domain.SecureDNS secureDNS=new Domain.SecureDNS();
  secureDNS.setDelegationSigned(Boolean.TRUE);
  final Domain.SecureDNS.DsData dsData=new Domain.SecureDNS.DsData();
  dsData.setKeyTag(12345L);
  dsData.setAlgorithm((short)3);
  dsData.setDigestType(1);
  dsData.setDigest("49FD46E6C4B45C55D4AC");
  secureDNS.getDsData().add(dsData);
  domain.setSecureDNS(secureDNS);
  assertThat(marshal(domain),equalTo("" + "{\n" + "  \"handle\" : \"XXXX\",\n"+ "  \"ldhName\" : \"192.in-addr.arpa\",\n"+ "  \"nameServers\" : [ {\n"+ "    \"ldhName\" : \"ns1.rir.example\",\n"+ "    \"objectClassName\" : \"nameserver\"\n"+ "  }, {\n"+ "    \"ldhName\" : \"ns2.rir.example\",\n"+ "    \"objectClassName\" : \"nameserver\"\n"+ "  } ],\n"+ "  \"secureDNS\" : {\n"+ "    \"delegationSigned\" : true,\n"+ "    \"dsData\" : [ {\n"+ "      \"keyTag\" : 12345,\n"+ "      \"algorithm\" : 3,\n"+ "      \"digest\" : \"49FD46E6C4B45C55D4AC\",\n"+ "      \"digestType\" : 1\n"+ "    } ]\n"+ "  },\n"+ "  \"entities\" : [ {\n"+ "    \"handle\" : \"XXXX\",\n"+ "    \"vcardArray\" : [ \"vcard\", [ [ \"version\", {"+ " }, \"text\", \"4.0\" ], [ \"fn\", {"+ " }, \"text\", \"Joe User\" ], [ \"kind\", {"+ " }, \"text\", \"individual\" ], [ \"org\", {"+ " }, \"text\", \"Example\" ], [ \"title\", {"+ " }, \"text\", \"Research Scientist\" ], [ \"role\", {"+ " }, \"text\", \"Project Lead\" ], [ \"adr\", {"+ " }, \"text\", [ \"\", \"Suite 1234\", \"4321 Rue Somewhere\", \"Quebec\", \"QC\", \"G1V 2M2\", \"Canada\" ] ], [ \"tel\", {"+ " }, \"uri\", \"tel:+1-555-555-1234;ext=102\" ], [ \"email\", {"+ " }, \"text\", \"joe.user@example.com\" ] ] ],\n"+ "    \"roles\" : [ \"registrant\" ],\n"+ "    \"remarks\" : [ {\n"+ "      \"description\" : [ \"She sells sea shells down by the sea shore.\", \"Originally written by Terry Sullivan.\" ]\n"+ "    } ],\n"+ "    \"links\" : [ {\n"+ "      \"value\" : \"http://example.net/entity/xxxx\",\n"+ "      \"rel\" : \"self\",\n"+ "      \"href\" : \"http://example.net/entity/xxxx\"\n"+ "    } ],\n"+ "    \"events\" : [ {\n"+ "      \"eventAction\" : \"registration\",\n"+ "      \"eventDate\" : \"2013-06-26T04:48:44Z\"\n"+ "    }, {\n"+ "      \"eventAction\" : \"last changed\",\n"+ "      \"eventDate\" : \"2013-06-26T04:48:44Z\",\n"+ "      \"eventActor\" : \"joe@example.com\"\n"+ "    } ],\n"+ "    \"objectClassName\" : \"entity\"\n"+ "  } ],\n"+ "  \"remarks\" : [ {\n"+ "    \"description\" : [ \"She sells sea shells down by the sea shore.\", \"Originally written by Terry Sullivan.\" ]\n"+ "  } ],\n"+ "  \"links\" : [ {\n"+ "    \"value\" : \"http://example.net/domain/XXXX\",\n"+ "    \"rel\" : \"self\",\n"+ "    \"href\" : \"http://example.net/domain/XXXXX\"\n"+ "  } ],\n"+ "  \"events\" : [ {\n"+ "    \"eventAction\" : \"registration\",\n"+ "    \"eventDate\" : \"2013-06-26T04:48:44Z\"\n"+ "  }, {\n"+ "    \"eventAction\" : \"last changed\",\n"+ "    \"eventDate\" : \"2013-06-26T04:48:44Z\",\n"+ "    \"eventActor\" : \"joe@example.com\"\n"+ "  } ],\n"+ "  \"objectClassName\" : \"domain\"\n"+ "}"));
}
