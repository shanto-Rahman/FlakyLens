@Test public void ip_serialization_test() throws Exception {
  Ip ip=new Ip();
  ip.setHandle("XXXX-RIR");
  ip.setParentHandle("YYYY-RIR");
  ip.setStartAddress("2001:db8::0");
  ip.setEndAddress("2001:db8::0:FFFF:FFFF:FFFF:FFFF:FFFF");
  ip.setIpVersion("v6");
  ip.setName("NET-RTR-1");
  ip.setType("DIRECT ALLOCATION");
  ip.setCountry("AU");
  ip.getStatus().add("allocated");
  final Remark remark=new Remark(Lists.newArrayList("She sells sea shells down by the sea shore.","Originally written by Terry Sullivan."));
  ip.getRemarks().add(remark);
  final Link link=new Link("http://example.net/ip/2001:db8::/48","self","http://example.net/ip/2001:db8::/48",null,null);
  ip.getLinks().add(link);
  final Link uplink=new Link("http://example.net/ip/2001:db8::/48","up","http://example.net/ip/2001:C00::/23",null,null);
  ip.getLinks().add(uplink);
  final Event registrationEvent=new Event();
  registrationEvent.setEventAction(Action.REGISTRATION);
  registrationEvent.setEventDate(LOCAL_DATE_TIME);
  ip.getEvents().add(registrationEvent);
  final Event lastChangedEvent=new Event();
  lastChangedEvent.setEventAction(Action.LAST_CHANGED);
  lastChangedEvent.setEventDate(LOCAL_DATE_TIME);
  lastChangedEvent.setEventActor("joe@example.com");
  ip.getEvents().add(lastChangedEvent);
  final Entity entity=new Entity();
  entity.setHandle("XXXX");
  final VCardBuilder builder=new VCardBuilder();
  builder.addVersion().addFn("Joe User").addKind("individual").addOrg("Example").addTitle("Research Scientist").addRole("Project Lead").addAdr(createAddress("","Suite 1234","4321 Rue Somewhere","Quebec","QC","G1V 2M2","Canada")).addTel("tel:+1-555-555-1234;ext=102").addEmail("joe.user@example.com");
  entity.setVCardArray(builder.build());
  entity.getRoles().add(Role.REGISTRANT);
  entity.getRemarks().add(remark);
  entity.getEvents().add(registrationEvent);
  entity.getEvents().add(lastChangedEvent);
  ip.getEntitySearchResults().add(entity);
  final Link entityLink=new Link("http://example.net/entity/xxxx","self","http://example.net/entity/xxxx",null,null);
  entity.getLinks().add(entityLink);
  assertThat(marshal(ip),equalTo("" + "{\n" + "  \"handle\" : \"XXXX-RIR\",\n"+ "  \"startAddress\" : \"2001:db8::0\",\n"+ "  \"endAddress\" : \"2001:db8::0:FFFF:FFFF:FFFF:FFFF:FFFF\",\n"+ "  \"ipVersion\" : \"v6\",\n"+ "  \"name\" : \"NET-RTR-1\",\n"+ "  \"type\" : \"DIRECT ALLOCATION\",\n"+ "  \"country\" : \"AU\",\n"+ "  \"parentHandle\" : \"YYYY-RIR\",\n"+ "  \"status\" : [ \"allocated\" ],\n"+ "  \"entities\" : [ {\n"+ "    \"handle\" : \"XXXX\",\n"+ "    \"vcardArray\" : [ \"vcard\", [ "+ "[ \"version\", { }, \"text\", \"4.0\" ], "+ "[ \"fn\", { }, \"text\", \"Joe User\" ], "+ "[ \"kind\", { }, \"text\", \"individual\" ], "+ "[ \"org\", { }, \"text\", \"Example\" ], "+ "[ \"title\", { }, \"text\", \"Research Scientist\" ], "+ "[ \"role\", { }, \"text\", \"Project Lead\" ], "+ "[ \"adr\", { }, \"text\", [ \"\", \"Suite 1234\", \"4321 Rue Somewhere\", \"Quebec\", \"QC\", \"G1V 2M2\", \"Canada\" ] ], "+ "[ \"tel\", { }, \"uri\", \"tel:+1-555-555-1234;ext=102\" ], "+ "[ \"email\", { }, \"text\", \"joe.user@example.com\" ] ] ],\n"+ "    \"roles\" : [ \"registrant\" ],\n"+ "    \"remarks\" : [ {\n"+ "      \"description\" : [ \"She sells sea shells down by the sea shore.\", \"Originally written by Terry Sullivan.\" ]\n"+ "    } ],\n"+ "    \"links\" : [ {\n"+ "      \"value\" : \"http://example.net/entity/xxxx\",\n"+ "      \"rel\" : \"self\",\n"+ "      \"href\" : \"http://example.net/entity/xxxx\"\n"+ "    } ],\n"+ "    \"events\" : [ {\n"+ "      \"eventAction\" : \"registration\",\n"+ "      \"eventDate\" : \"" + DATE_TIME + "\"\n"+ "    }, {\n"+ "      \"eventAction\" : \"last changed\",\n"+ "      \"eventDate\" : \""+ DATE_TIME+ "\",\n"+ "      \"eventActor\" : \"joe@example.com\"\n"+ "    } ],\n"+ "    \"objectClassName\" : \"entity\"\n"+ "  } ],\n"+ "  \"remarks\" : [ {\n"+ "    \"description\" : [ \"She sells sea shells down by the sea shore.\", \"Originally written by Terry Sullivan.\" ]\n"+ "  } ],\n"+ "  \"links\" : [ {\n"+ "    \"value\" : \"http://example.net/ip/2001:db8::/48\",\n"+ "    \"rel\" : \"self\",\n"+ "    \"href\" : \"http://example.net/ip/2001:db8::/48\"\n"+ "  }, {\n"+ "    \"value\" : \"http://example.net/ip/2001:db8::/48\",\n"+ "    \"rel\" : \"up\",\n"+ "    \"href\" : \"http://example.net/ip/2001:C00::/23\"\n"+ "  } ],\n"+ "  \"events\" : [ {\n"+ "    \"eventAction\" : \"registration\",\n"+ "    \"eventDate\" : \""+ DATE_TIME+ "\"\n"+ "  }, {\n"+ "    \"eventAction\" : \"last changed\",\n"+ "    \"eventDate\" : \""+ DATE_TIME+ "\",\n"+ "    \"eventActor\" : \"joe@example.com\"\n"+ "  } ],\n"+ "  \"objectClassName\" : \"ip network\"\n"+ "}"));
}
